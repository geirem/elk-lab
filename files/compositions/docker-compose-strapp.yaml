version: "3"

services:

  #STRAPP data.
  strapp_elastic:
    image: docker.stb.intra/storebrand/elastic:${ELK_IMAGE_VERSION}
    environment:
      - cluster.name=strapp
      - node.name=strapp-node
      - transport.host=${STRAPP_ELASTIC_IP}
      - transport.tcp.port=9300
      - cluster.routing.allocation.disk.watermark.low=20gb
      - cluster.routing.allocation.disk.watermark.high=10gb
      - cluster.routing.allocation.disk.watermark.flood_stage=5gb
      - cluster.initial_master_nodes=strapp-node
      - "ES_JAVA_OPTS=-Xms24g -Xmx24g"
    ulimits:
      memlock:
        soft: -1
        hard: -1
    networks:
      elk_net:
        ipv4_address: ${STRAPP_ELASTIC_IP}
        aliases:
          - strapp-node
    volumes:
      - ${ELK_DATA_DIR}/strapp/:/usr/share/elasticsearch/data

networks:
  elk_net:
    external:
      name: local_elk_net
