#!/usr/bin/env bash

#. <%= @elk_config_dir %>/env.sh

declare -x REMOTE_VERSION=7.2.0
declare -x LOCAL_VERSION=${ELK_IMAGE_VERSION}

function push_tag_pull {
   REMOTE_NAME=$1
   LOCAL_NAME=$2
   docker pull docker.elastic.co${REMOTE_NAME}:${REMOTE_VERSION}
   docker tag docker.elastic.co${REMOTE_NAME}:${REMOTE_VERSION} docker-internal.stb.intra/storebrand/${LOCAL_NAME}:${LOCAL_VERSION}
   docker push docker-internal.stb.intra/storebrand/${LOCAL_NAME}:${LOCAL_VERSION}
}

push_tag_pull /elasticsearch/elasticsearch-oss elastic
push_tag_pull /beats/filebeat filebeat
push_tag_pull /kibana/kibana-oss kibana
push_tag_pull /logstash/logstash-oss logstash
push_tag_pull /kibana/kibana-oss kibana

docker build -t docker-internal.stb.intra/storebrand/curator:${ELK_IMAGE_VERSION} curator
docker push docker-internal.stb.intra/storebrand/curator:${ELK_IMAGE_VERSION}

docker pull nginx:1.17.0
docker tag nginx:1.17.0 docker-internal.stb.intra/storebrand/nginx-elk:${LOCAL_VERSION}
docker push docker-internal.stb.intra/storebrand/nginx-elk:${LOCAL_VERSION}

docker pull byrnedo/alpine-curl:0.1.7
docker tag byrnedo/alpine-curl:0.1.7 docker-internal.stb.intra/storebrand/alpine-curl:${LOCAL_VERSION}
docker push docker-internal.stb.intra/storebrand/alpine-curl:${LOCAL_VERSION}
